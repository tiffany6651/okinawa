<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>旅程。Okinawa Cloud</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #fdfdfd; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .teal-gradient { background: linear-gradient(135deg, #7BAEA8 0%, #5F958F 100%); }
        .date-chip-active { background-color: #5F958F; color: white; box-shadow: 0 4px 12px rgba(95, 149, 143, 0.3); }
        .glass-nav { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="text-slate-600">
    <div id="app" class="min-h-screen pb-32">
        
        <header class="p-6 pt-10 flex justify-between items-baseline">
            <div>
                <h1 class="text-3xl font-light tracking-widest text-slate-800">旅程<span class="text-[#5F958F] font-bold">。</span></h1>
                <p class="text-[10px] text-slate-400 uppercase tracking-widest mt-1">Cloud Sync Active</p>
            </div>
        </header>

        <div class="px-6 mb-6">
            <div class="flex space-x-4 overflow-x-auto hide-scrollbar py-2">
                <div v-for="day in days" :key="day.date" 
                     @click="selectedDate = day.date"
                     :class="selectedDate === day.date ? 'date-chip-active scale-105' : 'bg-white text-slate-400 border border-slate-100'"
                     class="flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all duration-300 shadow-sm">
                    <span class="text-[10px] uppercase mb-1">{{ day.weekday }}</span>
                    <span class="text-lg font-bold">{{ day.dayNum }}</span>
                </div>
            </div>
        </div>

        <main v-if="activeTab === 'trip'" class="px-6 space-y-6">
            <div v-for="(item, index) in filteredItinerary" :key="item.id" class="bg-white rounded-3xl p-5 shadow-sm border border-slate-50 flex items-center space-x-4 relative">
                <div class="text-center border-r border-slate-100 pr-4">
                    <p class="text-[10px] text-slate-300 uppercase">{{ item.time.split(':')[0] }}H</p>
                    <p class="text-sm font-bold text-[#5F958F]">{{ item.time.split(':')[1] }}</p>
                </div>
                <div class="flex-1">
                    <h3 class="text-md font-medium text-slate-800">{{ item.location }}</h3>
                    <p class="text-xs text-slate-400 font-light">{{ item.note }}</p>
                </div>
                <button @click="removeItem(item.id)" class="text-slate-200 hover:text-red-300 transition">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
            <div v-if="filteredItinerary.length === 0" class="text-center py-20 text-slate-300 text-sm font-light">
                今日尚無行程，點擊 + 新增
            </div>
        </main>

        <main v-if="activeTab === 'wallet'" class="px-6 space-y-6">
            <div class="teal-gradient rounded-[32px] p-8 text-white shadow-xl">
                <h3 class="text-xs font-medium opacity-80 tracking-widest mb-6">CURRENCY CONVERTER</h3>
                <div class="space-y-4">
                    <div class="relative">
                        <span class="absolute left-4 top-3 text-white/50 text-[10px] uppercase">Input JPY</span>
                        <input v-model.number="jpyInput" type="number" class="w-full bg-white/10 border border-white/20 rounded-2xl p-6 pt-8 text-2xl font-bold focus:outline-none">
                    </div>
                    <div class="relative">
                        <span class="absolute left-4 top-3 text-white/50 text-[10px] uppercase">Result TWD</span>
                        <div class="w-full bg-white/10 border border-white/20 rounded-2xl p-6 pt-8 text-2xl font-bold">
                            {{ (jpyInput * 0.21).toFixed(0) }}
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div v-if="showModal" class="fixed inset-0 z-[100] flex items-end justify-center">
            <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" @click="showModal = false"></div>
            <div class="bg-white w-full rounded-t-[40px] p-8 pb-12 z-10 shadow-2xl transition-all transform">
                <h2 class="text-xl font-bold mb-6 text-slate-800">新增行程</h2>
                <div class="space-y-4">
                    <input v-model="newItem.time" type="time" class="w-full bg-slate-50 border-none rounded-2xl p-4">
                    <input v-model="newItem.location" type="text" placeholder="地點名稱" class="w-full bg-slate-50 border-none rounded-2xl p-4">
                    <input v-model="newItem.note" type="text" placeholder="備註內容" class="w-full bg-slate-50 border-none rounded-2xl p-4">
                    <button @click="pushItem" class="teal-gradient w-full text-white font-bold py-4 rounded-2xl shadow-lg mt-4">儲存至雲端</button>
                </div>
            </div>
        </div>

        <nav class="fixed bottom-8 left-8 right-8 h-20 glass-nav rounded-[32px] shadow-lg border border-white/50 flex justify-around items-center px-4 z-50">
            <button @click="activeTab = 'trip'" :class="activeTab === 'trip' ? 'text-[#5F958F]' : 'text-slate-300'" class="flex flex-col items-center">
                <i data-lucide="map" class="w-6 h-6"></i>
                <span class="text-[9px] mt-1 font-bold">旅程</span>
            </button>
            
            <button @click="showModal = true" class="teal-gradient w-14 h-14 rounded-3xl flex items-center justify-center text-white shadow-lg -translate-y-4">
                <i data-lucide="plus" class="w-7 h-7"></i>
            </button>

            <button @click="activeTab = 'wallet'" :class="activeTab === 'wallet' ? 'text-[#5F958F]' : 'text-slate-300'" class="flex flex-col items-center">
                <i data-lucide="coins" class="w-6 h-6"></i>
                <span class="text-[9px] mt-1 font-bold">分帳</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, nextTick } = Vue;

        // --- Firebase 配置 (請確保資料庫網址正確) ---
        const firebaseConfig = {
            apiKey: "AIzaSyBAnvTrhQks9CtBuTrTtVIhUJ-nVG5_Xeg",
            authDomain: "okinawa-ccd7b.firebaseapp.com",
            databaseURL: "https://okinawa-ccd7b-default-rtdb.firebaseio.com",
            projectId: "okinawa-ccd7b",
            storageBucket: "okinawa-ccd7b.firebasestorage.app",
            messagingSenderId: "338950854497",
            appId: "1:338950854497:web:866e408540c1e8749463f2"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tripRef = db.ref('okinawa/itinerary');

        createApp({
            setup() {
                const activeTab = ref('trip');
                const selectedDate = ref('04/16');
                const showModal = ref(false);
                const itinerary = ref([]);
                const jpyInput = ref(0);
                const newItem = ref({ time: '12:00', location: '', note: '' });

                const days = ref([
                    { date: '04/16', weekday: 'THU', dayNum: '16' },
                    { date: '04/17', weekday: 'FRI', dayNum: '17' },
                    { date: '04/18', weekday: 'SAT', dayNum: '18' },
                    { date: '04/19', weekday: 'SUN', dayNum: '19' },
                    { date: '04/20', weekday: 'MON', dayNum: '20' }
                ]);

                // 監聽雲端資料
                onMounted(() => {
                    tripRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        itinerary.value = data ? Object.values(data) : [];
                        nextTick(() => lucide.createIcons());
                    });
                });

                const filteredItinerary = computed(() => {
                    return itinerary.value
                        .filter(item => item.date === selectedDate.value)
                        .sort((a, b) => a.time.localeCompare(b.time));
                });

                // 新增行程
                const pushItem = () => {
                    if (!newItem.value.location) return;
                    const newPostRef = tripRef.push();
                    newPostRef.set({
                        ...newItem.value,
                        date: selectedDate.value,
                        id: newPostRef.key
                    });
                    newItem.value = { time: '12:00', location: '', note: '' };
                    showModal.value = false;
                };

                // 刪除行程
                const removeItem = (id) => {
                    db.ref(`okinawa/itinerary/${id}`).remove();
                };

                return { 
                    days, selectedDate, filteredItinerary, activeTab, 
                    jpyInput, showModal, newItem, pushItem, removeItem 
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
